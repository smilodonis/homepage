<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Enhanced Data Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.23.0/cdn.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@2.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f0f2f5; color: #333; }
        h1, h2 { text-align: center; color: #1a1a1a; }
        .dashboard { max-width: 1600px; margin: 0 auto; padding: 20px; }
        .charts-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; }
        .chart-container { background-color: #fff; border-radius: 8px; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .chart-container h3 { margin-top: 0; }
        .stock-info { font-size: 0.9em; color: #666; }
    </style>
</head>
<body>
    <h1>My Enhanced Data Dashboard</h1>

    <div class="dashboard">
        <h2>Stock Market</h2>
        <div id="stock-charts" class="charts-grid"></div>

        <h2>Cryptocurrency</h2>
        <div id="crypto-charts" class="charts-grid"></div>
    </div>

    <script>
        const stocks = ['AAPL', 'MSFT', 'GOOGL', 'AMZN', 'TSLA', 'NVDA'];
        const cryptos = ['bitcoin', 'ethereum', 'solana', 'ripple', 'dogecoin', 'cardano'];

        const stockChartsContainer = document.getElementById('stock-charts');
        stocks.forEach(ticker => {
            const chartDiv = document.createElement('div');
            chartDiv.className = 'chart-container';
            chartDiv.innerHTML = `<h3>${ticker}</h3><div class="stock-info" id="info-${ticker}">Loading info...</div><canvas id="chart-${ticker}"></canvas>`;
            stockChartsContainer.appendChild(chartDiv);

            fetch(`/api/stock/${ticker}`)
                .then(response => response.json())
                .then(data => {
                    const infoDiv = document.getElementById(`info-${ticker}`);
                    infoDiv.innerHTML = `
                        <strong>${data.info.shortName || ticker}</strong> (${data.info.symbol})<br>
                        Sector: ${data.info.sector || 'N/A'}<br>
                        Market Cap: ${data.info.marketCap ? (data.info.marketCap / 1e9).toFixed(2) + 'B' : 'N/A'}<br>
                        P/E Ratio: ${data.info.trailingPE ? data.info.trailingPE.toFixed(2) : 'N/A'}
                    `;

                    const dates = data.history.map(item => new Date(item.Date));
                    const prices = data.history.map(item => item.Close);
                    createChart(`chart-${ticker}`, dates, prices, `${ticker} Closing Price`, 'rgba(75, 192, 192, 1)');
                });
        });

        const cryptoChartsContainer = document.getElementById('crypto-charts');
        cryptos.forEach(coin => {
            const chartDiv = document.createElement('div');
            chartDiv.className = 'chart-container';
            chartDiv.innerHTML = `<h3>${coin.charAt(0).toUpperCase() + coin.slice(1)}</h3><canvas id="chart-${coin}"></canvas>`;
            cryptoChartsContainer.appendChild(chartDiv);

            fetch(`/api/crypto/history/${coin}`)
                .then(response => response.json())
                .then(data => {
                    const dates = data.map(item => new Date(item[0]));
                    const prices = data.map(item => item[1]);
                    createChart(`chart-${coin}`, dates, prices, `${coin.charAt(0).toUpperCase() + coin.slice(1)} Price`, 'rgba(255, 159, 64, 1)');
                });
        });

        function createChart(canvasId, labels, data, label, color) {
            const ctx = document.getElementById(canvasId).getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: label,
                        data: data,
                        borderColor: color,
                        borderWidth: 2,
                        fill: false,
                        pointRadius: 0,
                    }]
                },
                options: {
                    scales: {
                        x: { type: 'time', time: { unit: 'month' } },
                        y: { ticks: { callback: (value) => `$${value.toLocaleString()}` } }
                    }
                }
            });
        }
    </script>
</body>
</html>
